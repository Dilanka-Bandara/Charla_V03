{"ast":null,"code":"class WebSocketService {\n  constructor() {\n    this.ws = null;\n    this.listeners = {};\n    this.reconnectAttempts = 0;\n    this.maxReconnectAttempts = 5;\n    this.reconnectDelay = 3000;\n  }\n  connect(userId) {\n    const WS_URL = process.env.REACT_APP_WS_URL || 'ws://localhost:8000';\n    this.ws = new WebSocket(`${WS_URL}/ws/${userId}`);\n    this.ws.onopen = () => {\n      console.log('âœ… WebSocket Connected');\n      this.reconnectAttempts = 0;\n      this.emit('connected');\n    };\n    this.ws.onmessage = event => {\n      const data = JSON.parse(event.data);\n      console.log('ðŸ“© Received:', data);\n      this.emit(data.type, data);\n    };\n    this.ws.onerror = error => {\n      console.error('âŒ WebSocket Error:', error);\n      this.emit('error', error);\n    };\n    this.ws.onclose = () => {\n      console.log('ðŸ”Œ WebSocket Disconnected');\n      this.emit('disconnected');\n      this.attemptReconnect(userId);\n    };\n  }\n  attemptReconnect(userId) {\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\n      this.reconnectAttempts++;\n      console.log(`ðŸ”„ Reconnecting... Attempt ${this.reconnectAttempts}`);\n      setTimeout(() => {\n        this.connect(userId);\n      }, this.reconnectDelay);\n    }\n  }\n  send(data) {\n    if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n      this.ws.send(JSON.stringify(data));\n    } else {\n      console.warn('âš ï¸ WebSocket not connected');\n    }\n  }\n  joinRoom(roomId) {\n    this.send({\n      type: 'join_room',\n      room_id: roomId\n    });\n  }\n  leaveRoom(roomId) {\n    this.send({\n      type: 'leave_room',\n      room_id: roomId\n    });\n  }\n  sendMessage(roomId, message) {\n    this.send({\n      type: 'new_message',\n      room_id: roomId,\n      message\n    });\n  }\n  sendTyping(roomId, isTyping) {\n    this.send({\n      type: 'typing',\n      room_id: roomId,\n      is_typing: isTyping\n    });\n  }\n  sendReaction(roomId, messageId, reaction) {\n    this.send({\n      type: 'message_reaction',\n      room_id: roomId,\n      message_id: messageId,\n      reaction\n    });\n  }\n  markAsRead(roomId, messageId) {\n    this.send({\n      type: 'read_receipt',\n      room_id: roomId,\n      message_id: messageId\n    });\n  }\n  on(event, callback) {\n    if (!this.listeners[event]) {\n      this.listeners[event] = [];\n    }\n    this.listeners[event].push(callback);\n  }\n  off(event, callback) {\n    if (this.listeners[event]) {\n      this.listeners[event] = this.listeners[event].filter(cb => cb !== callback);\n    }\n  }\n  emit(event, data) {\n    if (this.listeners[event]) {\n      this.listeners[event].forEach(callback => callback(data));\n    }\n  }\n  disconnect() {\n    if (this.ws) {\n      this.ws.close();\n      this.ws = null;\n    }\n  }\n}\nexport default new WebSocketService();","map":{"version":3,"names":["WebSocketService","constructor","ws","listeners","reconnectAttempts","maxReconnectAttempts","reconnectDelay","connect","userId","WS_URL","process","env","REACT_APP_WS_URL","WebSocket","onopen","console","log","emit","onmessage","event","data","JSON","parse","type","onerror","error","onclose","attemptReconnect","setTimeout","send","readyState","OPEN","stringify","warn","joinRoom","roomId","room_id","leaveRoom","sendMessage","message","sendTyping","isTyping","is_typing","sendReaction","messageId","reaction","message_id","markAsRead","on","callback","push","off","filter","cb","forEach","disconnect","close"],"sources":["E:/Charla_V03/frontend/src/services/websocket.js"],"sourcesContent":["class WebSocketService {\r\n  constructor() {\r\n    this.ws = null;\r\n    this.listeners = {};\r\n    this.reconnectAttempts = 0;\r\n    this.maxReconnectAttempts = 5;\r\n    this.reconnectDelay = 3000;\r\n  }\r\n\r\n  connect(userId) {\r\n    const WS_URL = process.env.REACT_APP_WS_URL || 'ws://localhost:8000';\r\n    this.ws = new WebSocket(`${WS_URL}/ws/${userId}`);\r\n\r\n    this.ws.onopen = () => {\r\n      console.log('âœ… WebSocket Connected');\r\n      this.reconnectAttempts = 0;\r\n      this.emit('connected');\r\n    };\r\n\r\n    this.ws.onmessage = (event) => {\r\n      const data = JSON.parse(event.data);\r\n      console.log('ðŸ“© Received:', data);\r\n      this.emit(data.type, data);\r\n    };\r\n\r\n    this.ws.onerror = (error) => {\r\n      console.error('âŒ WebSocket Error:', error);\r\n      this.emit('error', error);\r\n    };\r\n\r\n    this.ws.onclose = () => {\r\n      console.log('ðŸ”Œ WebSocket Disconnected');\r\n      this.emit('disconnected');\r\n      this.attemptReconnect(userId);\r\n    };\r\n  }\r\n\r\n  attemptReconnect(userId) {\r\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\r\n      this.reconnectAttempts++;\r\n      console.log(`ðŸ”„ Reconnecting... Attempt ${this.reconnectAttempts}`);\r\n      setTimeout(() => {\r\n        this.connect(userId);\r\n      }, this.reconnectDelay);\r\n    }\r\n  }\r\n\r\n  send(data) {\r\n    if (this.ws && this.ws.readyState === WebSocket.OPEN) {\r\n      this.ws.send(JSON.stringify(data));\r\n    } else {\r\n      console.warn('âš ï¸ WebSocket not connected');\r\n    }\r\n  }\r\n\r\n  joinRoom(roomId) {\r\n    this.send({ type: 'join_room', room_id: roomId });\r\n  }\r\n\r\n  leaveRoom(roomId) {\r\n    this.send({ type: 'leave_room', room_id: roomId });\r\n  }\r\n\r\n  sendMessage(roomId, message) {\r\n    this.send({ type: 'new_message', room_id: roomId, message });\r\n  }\r\n\r\n  sendTyping(roomId, isTyping) {\r\n    this.send({ type: 'typing', room_id: roomId, is_typing: isTyping });\r\n  }\r\n\r\n  sendReaction(roomId, messageId, reaction) {\r\n    this.send({ type: 'message_reaction', room_id: roomId, message_id: messageId, reaction });\r\n  }\r\n\r\n  markAsRead(roomId, messageId) {\r\n    this.send({ type: 'read_receipt', room_id: roomId, message_id: messageId });\r\n  }\r\n\r\n  on(event, callback) {\r\n    if (!this.listeners[event]) {\r\n      this.listeners[event] = [];\r\n    }\r\n    this.listeners[event].push(callback);\r\n  }\r\n\r\n  off(event, callback) {\r\n    if (this.listeners[event]) {\r\n      this.listeners[event] = this.listeners[event].filter(cb => cb !== callback);\r\n    }\r\n  }\r\n\r\n  emit(event, data) {\r\n    if (this.listeners[event]) {\r\n      this.listeners[event].forEach(callback => callback(data));\r\n    }\r\n  }\r\n\r\n  disconnect() {\r\n    if (this.ws) {\r\n      this.ws.close();\r\n      this.ws = null;\r\n    }\r\n  }\r\n}\r\n\r\nexport default new WebSocketService();\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}