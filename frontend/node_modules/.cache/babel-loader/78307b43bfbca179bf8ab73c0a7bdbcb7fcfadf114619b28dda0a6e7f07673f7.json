{"ast":null,"code":"var _jsxFileName = \"E:\\\\Charla_V03\\\\frontend\\\\src\\\\contexts\\\\AuthContext.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useState, useContext, useEffect } from 'react';\nimport { login as loginAPI, register as registerAPI } from '../services/api';\nimport toast from 'react-hot-toast';\nimport websocketService from '../services/websocket'; // Added Import\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext(null);\nexport const useAuth = () => {\n  _s();\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within AuthProvider');\n  }\n  return context;\n};\n\n// Helper to safely extract error message from backend response\n_s(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nconst getErrorMessage = error => {\n  var _error$response, _error$response$data;\n  if ((_error$response = error.response) !== null && _error$response !== void 0 && (_error$response$data = _error$response.data) !== null && _error$response$data !== void 0 && _error$response$data.detail) {\n    const detail = error.response.data.detail;\n    // If detail is an array (Pydantic validation error), extract the first message\n    if (Array.isArray(detail)) {\n      return detail[0].msg || 'Validation error';\n    }\n    // If it's a string, return it\n    return detail;\n  }\n  return 'An error occurred';\n};\nexport const AuthProvider = ({\n  children\n}) => {\n  _s2();\n  const [user, setUser] = useState(null);\n  const [token, setToken] = useState(localStorage.getItem('token'));\n  const [isLoading, setIsLoading] = useState(true);\n  useEffect(() => {\n    const storedUser = localStorage.getItem('user');\n    const storedToken = localStorage.getItem('token');\n    if (storedUser && storedToken) {\n      try {\n        setUser(JSON.parse(storedUser));\n        setToken(storedToken);\n      } catch (e) {\n        console.error(\"Failed to parse stored user\", e);\n        localStorage.removeItem('user');\n        localStorage.removeItem('token');\n      }\n    }\n    setIsLoading(false);\n  }, []);\n  const login = async (username, password) => {\n    try {\n      const response = await loginAPI(username, password);\n      const {\n        access_token,\n        user: userData\n      } = response.data;\n      localStorage.setItem('token', access_token);\n      localStorage.setItem('user', JSON.stringify(userData));\n      setToken(access_token);\n      setUser(userData);\n      toast.success(`Welcome back, ${userData.username}! ðŸ‘‹`);\n      return true;\n    } catch (error) {\n      console.error(\"Login Error:\", error);\n      const msg = getErrorMessage(error);\n      toast.error(msg);\n      return false;\n    }\n  };\n  const register = async (username, email, password, fullName) => {\n    try {\n      const response = await registerAPI(username, email, password, fullName);\n      const {\n        access_token,\n        user: userData\n      } = response.data;\n      localStorage.setItem('token', access_token);\n      localStorage.setItem('user', JSON.stringify(userData));\n      setToken(access_token);\n      setUser(userData);\n      toast.success(`Account created! Welcome, ${userData.username}! ðŸŽ‰`);\n      return true;\n    } catch (error) {\n      console.error(\"Registration Error:\", error);\n      const msg = getErrorMessage(error);\n      toast.error(msg);\n      return false;\n    }\n  };\n  const logout = () => {\n    // CRITICAL FIX: Disconnect WebSocket on logout\n    websocketService.disconnect();\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    setToken(null);\n    setUser(null);\n    toast.success('Logged out successfully');\n  };\n  const value = {\n    user,\n    token,\n    isLoading,\n    login,\n    register,\n    logout,\n    isAuthenticated: !!token && !!user\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 115,\n    columnNumber: 10\n  }, this);\n};\n_s2(AuthProvider, \"Ezm03IKmqt4OOZSX4/9a6guLbc0=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","login","loginAPI","register","registerAPI","toast","websocketService","jsxDEV","_jsxDEV","AuthContext","useAuth","_s","context","Error","getErrorMessage","error","_error$response","_error$response$data","response","data","detail","Array","isArray","msg","AuthProvider","children","_s2","user","setUser","token","setToken","localStorage","getItem","isLoading","setIsLoading","storedUser","storedToken","JSON","parse","e","console","removeItem","username","password","access_token","userData","setItem","stringify","success","email","fullName","logout","disconnect","value","isAuthenticated","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["E:/Charla_V03/frontend/src/contexts/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport { login as loginAPI, register as registerAPI } from '../services/api';\r\nimport toast from 'react-hot-toast';\r\nimport websocketService from '../services/websocket'; // Added Import\r\n\r\nconst AuthContext = createContext(null);\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\n// Helper to safely extract error message from backend response\r\nconst getErrorMessage = (error) => {\r\n  if (error.response?.data?.detail) {\r\n    const detail = error.response.data.detail;\r\n    // If detail is an array (Pydantic validation error), extract the first message\r\n    if (Array.isArray(detail)) {\r\n      return detail[0].msg || 'Validation error';\r\n    }\r\n    // If it's a string, return it\r\n    return detail;\r\n  }\r\n  return 'An error occurred';\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [token, setToken] = useState(localStorage.getItem('token'));\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const storedUser = localStorage.getItem('user');\r\n    const storedToken = localStorage.getItem('token');\r\n    \r\n    if (storedUser && storedToken) {\r\n      try {\r\n        setUser(JSON.parse(storedUser));\r\n        setToken(storedToken);\r\n      } catch (e) {\r\n        console.error(\"Failed to parse stored user\", e);\r\n        localStorage.removeItem('user');\r\n        localStorage.removeItem('token');\r\n      }\r\n    }\r\n    setIsLoading(false);\r\n  }, []);\r\n\r\n  const login = async (username, password) => {\r\n    try {\r\n      const response = await loginAPI(username, password);\r\n      const { access_token, user: userData } = response.data; \r\n      \r\n      localStorage.setItem('token', access_token);\r\n      localStorage.setItem('user', JSON.stringify(userData));\r\n      \r\n      setToken(access_token);\r\n      setUser(userData);\r\n      \r\n      toast.success(`Welcome back, ${userData.username}! ðŸ‘‹`);\r\n      return true;\r\n    } catch (error) {\r\n      console.error(\"Login Error:\", error);\r\n      const msg = getErrorMessage(error);\r\n      toast.error(msg);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const register = async (username, email, password, fullName) => {\r\n    try {\r\n      const response = await registerAPI(username, email, password, fullName);\r\n      const { access_token, user: userData } = response.data; \r\n      \r\n      localStorage.setItem('token', access_token);\r\n      localStorage.setItem('user', JSON.stringify(userData));\r\n      \r\n      setToken(access_token);\r\n      setUser(userData);\r\n      \r\n      toast.success(`Account created! Welcome, ${userData.username}! ðŸŽ‰`);\r\n      return true;\r\n    } catch (error) {\r\n      console.error(\"Registration Error:\", error);\r\n      const msg = getErrorMessage(error);\r\n      toast.error(msg);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    // CRITICAL FIX: Disconnect WebSocket on logout\r\n    websocketService.disconnect();\r\n    \r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('user');\r\n    setToken(null);\r\n    setUser(null);\r\n    toast.success('Logged out successfully');\r\n  };\r\n\r\n  const value = {\r\n    user,\r\n    token,\r\n    isLoading,\r\n    login,\r\n    register,\r\n    logout,\r\n    isAuthenticated: !!token && !!user\r\n  };\r\n\r\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}