{"ast":null,"code":"import React,{useState}from'react';import{motion}from'framer-motion';import{FiTrash2}from'react-icons/fi';import{formatDistanceToNow}from'date-fns';import{useAuth}from'../../contexts/AuthContext';import{deleteMessage,addReaction}from'../../services/api';import Avatar from'../Common/Avatar';import toast from'react-hot-toast';import'./MessageItem.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const QUICK_REACTIONS=['ðŸ‘','â¤ï¸','ðŸ˜‚','ðŸ˜®','ðŸ˜¢','ðŸ”¥'];const MessageItem=_ref=>{let{message,index}=_ref;const{user}=useAuth();const[showActions,setShowActions]=useState(false);const[showReactions,setShowReactions]=useState(false);const isOwnMessage=message.user_id===user.id;const handleDelete=async()=>{try{await deleteMessage(message.id);toast.success('Message deleted');}catch(error){toast.error('Failed to delete message');}};const handleReaction=async emoji=>{try{await addReaction(message.id,emoji);setShowReactions(false);}catch(error){console.error('Failed to add reaction:',error);}};const getReactionCount=()=>{var _message$reactions;const counts={};(_message$reactions=message.reactions)===null||_message$reactions===void 0?void 0:_message$reactions.forEach(reaction=>{counts[reaction.emoji]=(counts[reaction.emoji]||0)+1;});return counts;};const reactionCounts=getReactionCount();return/*#__PURE__*/_jsxs(motion.div,{className:\"message-item \".concat(isOwnMessage?'own-message':'other-message'),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:index*0.05},onMouseEnter:()=>setShowActions(true),onMouseLeave:()=>{setShowActions(false);setShowReactions(false);},children:[!isOwnMessage&&/*#__PURE__*/_jsx(Avatar,{user:message,size:\"sm\",showOnline:false}),/*#__PURE__*/_jsxs(\"div\",{className:\"message-content-wrapper\",children:[!isOwnMessage&&/*#__PURE__*/_jsxs(\"div\",{className:\"message-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"message-username\",style:{color:message.avatar_color},children:message.username}),/*#__PURE__*/_jsx(\"span\",{className:\"message-time\",children:formatDistanceToNow(new Date(message.timestamp),{addSuffix:true})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"message-bubble \".concat(isOwnMessage?'own':'other'),children:[/*#__PURE__*/_jsx(\"p\",{children:message.content}),isOwnMessage&&/*#__PURE__*/_jsx(\"span\",{className:\"message-time-own\",children:new Date(message.timestamp).toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'})})]}),Object.keys(reactionCounts).length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"message-reactions\",children:Object.entries(reactionCounts).map(_ref2=>{let[emoji,count]=_ref2;return/*#__PURE__*/_jsxs(motion.button,{className:\"reaction-bubble\",onClick:()=>handleReaction(emoji),whileHover:{scale:1.1},whileTap:{scale:0.9},children:[emoji,\" \",count>1&&count]},emoji);})}),showActions&&/*#__PURE__*/_jsxs(motion.div,{className:\"message-actions\",initial:{opacity:0,scale:0.8},animate:{opacity:1,scale:1},children:[/*#__PURE__*/_jsx(\"button\",{className:\"action-btn\",onClick:()=>setShowReactions(!showReactions),children:\"\\uD83D\\uDE0A\"}),isOwnMessage&&/*#__PURE__*/_jsx(\"button\",{className:\"action-btn\",onClick:handleDelete,children:/*#__PURE__*/_jsx(FiTrash2,{size:14})})]}),showReactions&&/*#__PURE__*/_jsx(motion.div,{className:\"reaction-picker\",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:QUICK_REACTIONS.map(emoji=>/*#__PURE__*/_jsx(\"button\",{className:\"reaction-option\",onClick:()=>handleReaction(emoji),children:emoji},emoji))})]})]});};export default MessageItem;","map":{"version":3,"names":["React","useState","motion","FiTrash2","formatDistanceToNow","useAuth","deleteMessage","addReaction","Avatar","toast","jsx","_jsx","jsxs","_jsxs","QUICK_REACTIONS","MessageItem","_ref","message","index","user","showActions","setShowActions","showReactions","setShowReactions","isOwnMessage","user_id","id","handleDelete","success","error","handleReaction","emoji","console","getReactionCount","_message$reactions","counts","reactions","forEach","reaction","reactionCounts","div","className","concat","initial","opacity","y","animate","transition","delay","onMouseEnter","onMouseLeave","children","size","showOnline","style","color","avatar_color","username","Date","timestamp","addSuffix","content","toLocaleTimeString","hour","minute","Object","keys","length","entries","map","_ref2","count","button","onClick","whileHover","scale","whileTap"],"sources":["E:/Charla_V03/frontend/src/components/Chat/MessageItem.jsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { FiTrash2 } from 'react-icons/fi';\r\nimport { formatDistanceToNow } from 'date-fns';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport { deleteMessage, addReaction } from '../../services/api';\r\nimport Avatar from '../Common/Avatar';\r\nimport toast from 'react-hot-toast';\r\nimport './MessageItem.css';\r\n\r\nconst QUICK_REACTIONS = ['ðŸ‘', 'â¤ï¸', 'ðŸ˜‚', 'ðŸ˜®', 'ðŸ˜¢', 'ðŸ”¥'];\r\n\r\nconst MessageItem = ({ message, index }) => {\r\n  const { user } = useAuth();\r\n  const [showActions, setShowActions] = useState(false);\r\n  const [showReactions, setShowReactions] = useState(false);\r\n  const isOwnMessage = message.user_id === user.id;\r\n\r\n  const handleDelete = async () => {\r\n    try {\r\n      await deleteMessage(message.id);\r\n      toast.success('Message deleted');\r\n    } catch (error) {\r\n      toast.error('Failed to delete message');\r\n    }\r\n  };\r\n\r\n  const handleReaction = async (emoji) => {\r\n    try {\r\n      await addReaction(message.id, emoji);\r\n      setShowReactions(false);\r\n    } catch (error) {\r\n      console.error('Failed to add reaction:', error);\r\n    }\r\n  };\r\n\r\n  const getReactionCount = () => {\r\n    const counts = {};\r\n    message.reactions?.forEach(reaction => {\r\n      counts[reaction.emoji] = (counts[reaction.emoji] || 0) + 1;\r\n    });\r\n    return counts;\r\n  };\r\n\r\n  const reactionCounts = getReactionCount();\r\n\r\n  return (\r\n    <motion.div\r\n      className={`message-item ${isOwnMessage ? 'own-message' : 'other-message'}`}\r\n      initial={{ opacity: 0, y: 20 }}\r\n      animate={{ opacity: 1, y: 0 }}\r\n      transition={{ delay: index * 0.05 }}\r\n      onMouseEnter={() => setShowActions(true)}\r\n      onMouseLeave={() => {\r\n        setShowActions(false);\r\n        setShowReactions(false);\r\n      }}\r\n    >\r\n      {!isOwnMessage && (\r\n        <Avatar user={message} size=\"sm\" showOnline={false} />\r\n      )}\r\n\r\n      <div className=\"message-content-wrapper\">\r\n        {!isOwnMessage && (\r\n          <div className=\"message-header\">\r\n            <span className=\"message-username\" style={{ color: message.avatar_color }}>\r\n              {message.username}\r\n            </span>\r\n            <span className=\"message-time\">\r\n              {formatDistanceToNow(new Date(message.timestamp), { addSuffix: true })}\r\n            </span>\r\n          </div>\r\n        )}\r\n\r\n        <div className={`message-bubble ${isOwnMessage ? 'own' : 'other'}`}>\r\n          <p>{message.content}</p>\r\n          \r\n          {isOwnMessage && (\r\n            <span className=\"message-time-own\">\r\n              {new Date(message.timestamp).toLocaleTimeString('en-US', {\r\n                hour: '2-digit',\r\n                minute: '2-digit'\r\n              })}\r\n            </span>\r\n          )}\r\n        </div>\r\n\r\n        {Object.keys(reactionCounts).length > 0 && (\r\n          <div className=\"message-reactions\">\r\n            {Object.entries(reactionCounts).map(([emoji, count]) => (\r\n              <motion.button\r\n                key={emoji}\r\n                className=\"reaction-bubble\"\r\n                onClick={() => handleReaction(emoji)}\r\n                whileHover={{ scale: 1.1 }}\r\n                whileTap={{ scale: 0.9 }}\r\n              >\r\n                {emoji} {count > 1 && count}\r\n              </motion.button>\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        {showActions && (\r\n          <motion.div\r\n            className=\"message-actions\"\r\n            initial={{ opacity: 0, scale: 0.8 }}\r\n            animate={{ opacity: 1, scale: 1 }}\r\n          >\r\n            <button\r\n              className=\"action-btn\"\r\n              onClick={() => setShowReactions(!showReactions)}\r\n            >\r\n              ðŸ˜Š\r\n            </button>\r\n            {isOwnMessage && (\r\n              <button className=\"action-btn\" onClick={handleDelete}>\r\n                <FiTrash2 size={14} />\r\n              </button>\r\n            )}\r\n          </motion.div>\r\n        )}\r\n\r\n        {showReactions && (\r\n          <motion.div\r\n            className=\"reaction-picker\"\r\n            initial={{ opacity: 0, y: 10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n          >\r\n            {QUICK_REACTIONS.map(emoji => (\r\n              <button\r\n                key={emoji}\r\n                className=\"reaction-option\"\r\n                onClick={() => handleReaction(emoji)}\r\n              >\r\n                {emoji}\r\n              </button>\r\n            ))}\r\n          </motion.div>\r\n        )}\r\n      </div>\r\n    </motion.div>\r\n  );\r\n};\r\n\r\nexport default MessageItem;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}