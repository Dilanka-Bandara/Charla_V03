{"ast":null,"code":"class WebSocketService {\n  constructor() {\n    this.ws = null;\n    this.reconnectAttempts = 0;\n    this.maxReconnectAttempts = 5;\n    this.reconnectDelay = 3000;\n    this.eventHandlers = new Map();\n  }\n  connect(userId) {\n    var _this$ws;\n    if (((_this$ws = this.ws) === null || _this$ws === void 0 ? void 0 : _this$ws.readyState) === WebSocket.OPEN) {\n      return;\n    }\n    const WS_URL = process.env.REACT_APP_WS_URL || 'ws://localhost:8000';\n    this.ws = new WebSocket(`${WS_URL}/ws/${userId}`);\n    this.ws.onopen = () => {\n      console.log('WebSocket connected');\n      this.reconnectAttempts = 0;\n    };\n    this.ws.onmessage = event => {\n      try {\n        const data = JSON.parse(event.data);\n        this.handleMessage(data);\n      } catch (error) {\n        console.error('Failed to parse WebSocket message:', error);\n      }\n    };\n    this.ws.onerror = error => {\n      console.error('WebSocket error:', error);\n    };\n    this.ws.onclose = () => {\n      console.log('WebSocket disconnected');\n      this.handleReconnect(userId);\n    };\n  }\n  handleReconnect(userId) {\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\n      this.reconnectAttempts++;\n      console.log(`Reconnecting... Attempt ${this.reconnectAttempts}`);\n      setTimeout(() => {\n        this.connect(userId);\n      }, this.reconnectDelay);\n    } else {\n      console.error('Max reconnection attempts reached');\n    }\n  }\n  handleMessage(data) {\n    const handlers = this.eventHandlers.get(data.type);\n    if (handlers) {\n      handlers.forEach(handler => handler(data));\n    }\n  }\n  subscribeToEvent(eventType, callback) {\n    if (!this.eventHandlers.has(eventType)) {\n      this.eventHandlers.set(eventType, new Set());\n    }\n    this.eventHandlers.get(eventType).add(callback);\n    return () => {\n      const handlers = this.eventHandlers.get(eventType);\n      if (handlers) {\n        handlers.delete(callback);\n      }\n    };\n  }\n  sendMessage(message) {\n    var _this$ws2;\n    if (((_this$ws2 = this.ws) === null || _this$ws2 === void 0 ? void 0 : _this$ws2.readyState) === WebSocket.OPEN) {\n      this.ws.send(JSON.stringify(message));\n    } else {\n      console.error('WebSocket is not connected');\n    }\n  }\n  joinRoom(roomId) {\n    this.sendMessage({\n      type: 'join_room',\n      room_id: roomId\n    });\n  }\n  sendTyping(roomId, isTyping) {\n    this.sendMessage({\n      type: 'typing',\n      room_id: roomId,\n      is_typing: isTyping\n    });\n  }\n  disconnect() {\n    if (this.ws) {\n      this.ws.close();\n      this.ws = null;\n    }\n  }\n}\nconst websocketService = new WebSocketService();\nexport default websocketService;","map":{"version":3,"names":["WebSocketService","constructor","ws","reconnectAttempts","maxReconnectAttempts","reconnectDelay","eventHandlers","Map","connect","userId","_this$ws","readyState","WebSocket","OPEN","WS_URL","process","env","REACT_APP_WS_URL","onopen","console","log","onmessage","event","data","JSON","parse","handleMessage","error","onerror","onclose","handleReconnect","setTimeout","handlers","get","type","forEach","handler","subscribeToEvent","eventType","callback","has","set","Set","add","delete","sendMessage","message","_this$ws2","send","stringify","joinRoom","roomId","room_id","sendTyping","isTyping","is_typing","disconnect","close","websocketService"],"sources":["E:/Charla_V03/frontend/src/services/websocket.js"],"sourcesContent":["class WebSocketService {\r\n  constructor() {\r\n    this.ws = null;\r\n    this.reconnectAttempts = 0;\r\n    this.maxReconnectAttempts = 5;\r\n    this.reconnectDelay = 3000;\r\n    this.eventHandlers = new Map();\r\n  }\r\n\r\n  connect(userId) {\r\n    if (this.ws?.readyState === WebSocket.OPEN) {\r\n      return;\r\n    }\r\n\r\n    const WS_URL = process.env.REACT_APP_WS_URL || 'ws://localhost:8000';\r\n    this.ws = new WebSocket(`${WS_URL}/ws/${userId}`);\r\n\r\n    this.ws.onopen = () => {\r\n      console.log('WebSocket connected');\r\n      this.reconnectAttempts = 0;\r\n    };\r\n\r\n    this.ws.onmessage = (event) => {\r\n      try {\r\n        const data = JSON.parse(event.data);\r\n        this.handleMessage(data);\r\n      } catch (error) {\r\n        console.error('Failed to parse WebSocket message:', error);\r\n      }\r\n    };\r\n\r\n    this.ws.onerror = (error) => {\r\n      console.error('WebSocket error:', error);\r\n    };\r\n\r\n    this.ws.onclose = () => {\r\n      console.log('WebSocket disconnected');\r\n      this.handleReconnect(userId);\r\n    };\r\n  }\r\n\r\n  handleReconnect(userId) {\r\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\r\n      this.reconnectAttempts++;\r\n      console.log(`Reconnecting... Attempt ${this.reconnectAttempts}`);\r\n      setTimeout(() => {\r\n        this.connect(userId);\r\n      }, this.reconnectDelay);\r\n    } else {\r\n      console.error('Max reconnection attempts reached');\r\n    }\r\n  }\r\n\r\n  handleMessage(data) {\r\n    const handlers = this.eventHandlers.get(data.type);\r\n    if (handlers) {\r\n      handlers.forEach(handler => handler(data));\r\n    }\r\n  }\r\n\r\n  subscribeToEvent(eventType, callback) {\r\n    if (!this.eventHandlers.has(eventType)) {\r\n      this.eventHandlers.set(eventType, new Set());\r\n    }\r\n    this.eventHandlers.get(eventType).add(callback);\r\n\r\n    return () => {\r\n      const handlers = this.eventHandlers.get(eventType);\r\n      if (handlers) {\r\n        handlers.delete(callback);\r\n      }\r\n    };\r\n  }\r\n\r\n  sendMessage(message) {\r\n    if (this.ws?.readyState === WebSocket.OPEN) {\r\n      this.ws.send(JSON.stringify(message));\r\n    } else {\r\n      console.error('WebSocket is not connected');\r\n    }\r\n  }\r\n\r\n  joinRoom(roomId) {\r\n    this.sendMessage({\r\n      type: 'join_room',\r\n      room_id: roomId\r\n    });\r\n  }\r\n\r\n  sendTyping(roomId, isTyping) {\r\n    this.sendMessage({\r\n      type: 'typing',\r\n      room_id: roomId,\r\n      is_typing: isTyping\r\n    });\r\n  }\r\n\r\n  disconnect() {\r\n    if (this.ws) {\r\n      this.ws.close();\r\n      this.ws = null;\r\n    }\r\n  }\r\n}\r\n\r\nconst websocketService = new WebSocketService();\r\nexport default websocketService;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}