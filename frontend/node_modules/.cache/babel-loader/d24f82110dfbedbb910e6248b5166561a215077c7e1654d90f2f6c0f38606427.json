{"ast":null,"code":"class WebSocketService{constructor(){this.ws=null;this.reconnectAttempts=0;this.maxReconnectAttempts=5;this.reconnectDelay=3000;this.eventHandlers=new Map();}connect(userId){var _this$ws;if(((_this$ws=this.ws)===null||_this$ws===void 0?void 0:_this$ws.readyState)===WebSocket.OPEN){return;}const WS_URL=process.env.REACT_APP_WS_URL||'ws://localhost:8000';this.ws=new WebSocket(\"\".concat(WS_URL,\"/ws/\").concat(userId));this.ws.onopen=()=>{console.log('WebSocket connected');this.reconnectAttempts=0;};this.ws.onmessage=event=>{try{const data=JSON.parse(event.data);this.handleMessage(data);}catch(error){console.error('Failed to parse WebSocket message:',error);}};this.ws.onerror=error=>{console.error('WebSocket error:',error);};this.ws.onclose=()=>{console.log('WebSocket disconnected');this.handleReconnect(userId);};}handleReconnect(userId){if(this.reconnectAttempts<this.maxReconnectAttempts){this.reconnectAttempts++;console.log(\"Reconnecting... Attempt \".concat(this.reconnectAttempts));setTimeout(()=>{this.connect(userId);},this.reconnectDelay);}else{console.error('Max reconnection attempts reached');}}handleMessage(data){const handlers=this.eventHandlers.get(data.type);if(handlers){handlers.forEach(handler=>handler(data));}}subscribeToEvent(eventType,callback){if(!this.eventHandlers.has(eventType)){this.eventHandlers.set(eventType,new Set());}this.eventHandlers.get(eventType).add(callback);return()=>{const handlers=this.eventHandlers.get(eventType);if(handlers){handlers.delete(callback);}};}sendMessage(message){var _this$ws2;if(((_this$ws2=this.ws)===null||_this$ws2===void 0?void 0:_this$ws2.readyState)===WebSocket.OPEN){this.ws.send(JSON.stringify(message));}else{console.error('WebSocket is not connected');}}joinRoom(roomId){this.sendMessage({type:'join_room',room_id:roomId});}sendTyping(roomId,isTyping){this.sendMessage({type:'typing',room_id:roomId,is_typing:isTyping});}disconnect(){if(this.ws){this.ws.close();this.ws=null;}}}const websocketService=new WebSocketService();export default websocketService;","map":{"version":3,"names":["WebSocketService","constructor","ws","reconnectAttempts","maxReconnectAttempts","reconnectDelay","eventHandlers","Map","connect","userId","_this$ws","readyState","WebSocket","OPEN","WS_URL","process","env","REACT_APP_WS_URL","concat","onopen","console","log","onmessage","event","data","JSON","parse","handleMessage","error","onerror","onclose","handleReconnect","setTimeout","handlers","get","type","forEach","handler","subscribeToEvent","eventType","callback","has","set","Set","add","delete","sendMessage","message","_this$ws2","send","stringify","joinRoom","roomId","room_id","sendTyping","isTyping","is_typing","disconnect","close","websocketService"],"sources":["E:/Charla_V03/frontend/src/services/websocket.js"],"sourcesContent":["class WebSocketService {\r\n  constructor() {\r\n    this.ws = null;\r\n    this.reconnectAttempts = 0;\r\n    this.maxReconnectAttempts = 5;\r\n    this.reconnectDelay = 3000;\r\n    this.eventHandlers = new Map();\r\n  }\r\n\r\n  connect(userId) {\r\n    if (this.ws?.readyState === WebSocket.OPEN) {\r\n      return;\r\n    }\r\n\r\n    const WS_URL = process.env.REACT_APP_WS_URL || 'ws://localhost:8000';\r\n    this.ws = new WebSocket(`${WS_URL}/ws/${userId}`);\r\n\r\n    this.ws.onopen = () => {\r\n      console.log('WebSocket connected');\r\n      this.reconnectAttempts = 0;\r\n    };\r\n\r\n    this.ws.onmessage = (event) => {\r\n      try {\r\n        const data = JSON.parse(event.data);\r\n        this.handleMessage(data);\r\n      } catch (error) {\r\n        console.error('Failed to parse WebSocket message:', error);\r\n      }\r\n    };\r\n\r\n    this.ws.onerror = (error) => {\r\n      console.error('WebSocket error:', error);\r\n    };\r\n\r\n    this.ws.onclose = () => {\r\n      console.log('WebSocket disconnected');\r\n      this.handleReconnect(userId);\r\n    };\r\n  }\r\n\r\n  handleReconnect(userId) {\r\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\r\n      this.reconnectAttempts++;\r\n      console.log(`Reconnecting... Attempt ${this.reconnectAttempts}`);\r\n      setTimeout(() => {\r\n        this.connect(userId);\r\n      }, this.reconnectDelay);\r\n    } else {\r\n      console.error('Max reconnection attempts reached');\r\n    }\r\n  }\r\n\r\n  handleMessage(data) {\r\n    const handlers = this.eventHandlers.get(data.type);\r\n    if (handlers) {\r\n      handlers.forEach(handler => handler(data));\r\n    }\r\n  }\r\n\r\n  subscribeToEvent(eventType, callback) {\r\n    if (!this.eventHandlers.has(eventType)) {\r\n      this.eventHandlers.set(eventType, new Set());\r\n    }\r\n    this.eventHandlers.get(eventType).add(callback);\r\n\r\n    return () => {\r\n      const handlers = this.eventHandlers.get(eventType);\r\n      if (handlers) {\r\n        handlers.delete(callback);\r\n      }\r\n    };\r\n  }\r\n\r\n  sendMessage(message) {\r\n    if (this.ws?.readyState === WebSocket.OPEN) {\r\n      this.ws.send(JSON.stringify(message));\r\n    } else {\r\n      console.error('WebSocket is not connected');\r\n    }\r\n  }\r\n\r\n  joinRoom(roomId) {\r\n    this.sendMessage({\r\n      type: 'join_room',\r\n      room_id: roomId\r\n    });\r\n  }\r\n\r\n  sendTyping(roomId, isTyping) {\r\n    this.sendMessage({\r\n      type: 'typing',\r\n      room_id: roomId,\r\n      is_typing: isTyping\r\n    });\r\n  }\r\n\r\n  disconnect() {\r\n    if (this.ws) {\r\n      this.ws.close();\r\n      this.ws = null;\r\n    }\r\n  }\r\n}\r\n\r\nconst websocketService = new WebSocketService();\r\nexport default websocketService;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}